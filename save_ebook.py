# cd d:
# cd d:\tom\scripts
# py save_ebook.py

import requests

base = "https://twigserial.wordpress.com"
chapters = [
"?cat=335145234",
"?cat=289739",
"?cat=20203420",
"?cat=21037039",
"?cat=11693151",
"?cat=20559853",
"?cat=21573041",
"?cat=11693436",
"?cat=11693254",
"?cat=11692444",
"?cat=382650",
"?cat=6762658",
"?cat=3147327",
"?cat=346260264",
"?cat=346881996",
"?cat=21734881",
"?cat=21734883",
"?cat=22725876",
"?cat=21598908",
"?cat=11693909",
"?cat=24118768",
"?cat=705702",
"?cat=16374430",
"?cat=26354851",
"?cat=432065",
"?cat=11702157",
"?cat=355952418",
"?cat=356777123",
"?cat=23117586",
"?cat=24703902",
"?cat=31669281",
"?cat=32105009",
"?cat=23142230",
"?cat=20495613",
"?cat=705703",
"?cat=24065921",
"?cat=27570576",
"?cat=5375272",
"?cat=368828023",
"?cat=367697853",
"?cat=18682384",
"?cat=22564161",
"?cat=28740457",
"?cat=28845220",
"?cat=22967058",
"?cat=5259044",
"?cat=705704",
"?cat=5586245",
"?cat=36049233",
"?cat=11698023",
"?cat=11702453",
"?cat=2212278",
"?cat=378624314",
"?cat=379432259",
"?cat=22967056",
"?cat=35340418",
"?cat=22258917",
"?cat=35340711",
"?cat=20365731",
"?cat=25571088",
"?cat=25539482",
"?cat=22259329",
"?cat=36504408",
"?cat=1028044",
"?cat=13116160",
"?cat=2017170",
"?cat=4827613",
"?cat=3821579",
"?cat=4199599",
"?cat=11111676",
"?cat=396976880",
"?cat=33843508",
"?cat=396976891",
"?cat=31024954",
"?cat=20809971",
"?cat=31696527",
"?cat=20638593",
"?cat=32562113",
"?cat=56667615",
"?cat=33096141",
"?cat=459589",
"?cat=9616762",
"?cat=2260082",
"?cat=21166180",
"?cat=20915128",
"?cat=409940914",
"?cat=24435037",
"?cat=23755003",
"?cat=62977507",
"?cat=20883862",
"?cat=20750912",
"?cat=57529820",
"?cat=32721917",
"?cat=24704087",
"?cat=24703857",
"?cat=2963299",
"?cat=119573",
"?cat=28295",
"?cat=35228132",
"?cat=8476580",
"?cat=22963870",
"?cat=29532947",
"?cat=424945375",
"?cat=426347385",
"?cat=427246284",
"?cat=23751857",
"?cat=31196878",
"?cat=65154967",
"?cat=20379126",
"?cat=51948487",
"?cat=48524491",
"?cat=52109837",
"?cat=57562994",
"?cat=37312757",
"?cat=10839957",
"?cat=23193233",
"?cat=418238",
"?cat=1433447",
"?cat=2339042",
"?cat=23958523",
"?cat=5718542",
"?cat=444911900",
"?cat=445959568",
"?cat=25174575",
"?cat=25873742",
"?cat=50411459",
"?cat=12315371",
"?cat=26987317",
"?cat=12184671",
"?cat=23794951",
"?cat=23114217",
"?cat=10900128",
"?cat=2527038",
"?cat=75936",
"?cat=448385",
"?cat=6216663",
"?cat=20006030",
"?cat=37905416",
"?cat=5279156",
"?cat=2911745",
"?cat=5590786",
"?cat=474220012",
"?cat=475400706",
"?cat=1974475",
"?cat=20771642",
"?cat=18349994",
"?cat=21459063",
"?cat=35275604",
"?cat=38024259",
"?cat=22641275",
"?cat=4803169",
"?cat=341872",
"?cat=2217477",
"?cat=5831147",
"?cat=1577748",
"?cat=4072053",
"?cat=4652059",
"?cat=429736",
"?cat=1953720",
"?cat=9533994",
"?cat=1353326",
"?cat=12315923",
"?cat=193204",
"?cat=496090522",
"?cat=496749863",
"?cat=7828717",
"?cat=27150064",
"?cat=513142998",
"?cat=19015104",
"?cat=513143043",
"?cat=37103309",
"?cat=24705240",
"?cat=13142868",
"?cat=343958",
"?cat=9498254",
"?cat=4885587",
"?cat=1686652",
"?cat=7950345",
"?cat=429767",
"?cat=513223984",
"?cat=513961233",
"?cat=57283364",
"?cat=27914461",
"?cat=27911466",
"?cat=19015105",
"?cat=27915012",
"?cat=21547325",
"?cat=14198216",
"?cat=17048206",
"?cat=352389",
"?cat=14310589",
"?cat=27915092",
"?cat=1484068",
"?cat=528629447",
"?cat=528629481",
"?cat=30413176",
"?cat=17324853",
"?cat=34310047",
"?cat=20255579",
"?cat=20509536",
"?cat=65401831",
"?cat=87453727",
"?cat=352390",
"?cat=15562629",
"?cat=26276138",
"?cat=537069580",
"?cat=4127839",
"?cat=16456249",
"?cat=28452887",
"?cat=68079801",
"?cat=20404006",
"?cat=21618610",
"?cat=39030272",
"?cat=39055634",
"?cat=352393",
"?cat=1772735",
"?cat=24703684",
"?cat=20366075",
"?cat=79643895",
"?cat=57615275",
"?cat=13589792",
"?cat=9592402",
"?cat=13221557",
"?cat=889163",
"?cat=546748288",
"?cat=547068567",
"?cat=49501505",
"?cat=29251154",
"?cat=32988759",
"?cat=34407778",
"?cat=1113859",
"?cat=21607872",
"?cat=22132575",
"?cat=91301608",
"?cat=352394",
"?cat=25272916",
"?cat=20271836",
"?cat=1186767",
"?cat=92349678",
"?cat=36262059",
"?cat=12034634",
"?cat=17492165",
"?cat=552738437",
"?cat=552991979",
"?cat=20312944",
"?cat=51437173",
"?cat=24704595",
"?cat=34456843",
"?cat=47598812",
"?cat=21705411",
"?cat=8947000",
"?cat=23376482",
"?cat=356775",
"?cat=11684061",
"?cat=56428601",
"?cat=4368641",
"?cat=25443543",
"?cat=558724028",
"?cat=559158678",
"?cat=48484928",
"?cat=79349541",
"?cat=33086568",
"?cat=34529363",
"?cat=20517586",
"?cat=7934117",
"?cat=38220075",
"?cat=16464821",
"?cat=357745",
"?cat=26560465",
"?cat=25702030",
"?cat=7044592",
"?cat=67018135",
"?cat=4563000",
"?cat=19741795",
"?cat=48768312",
"?cat=38431396",
"?cat=3261375",
"?cat=568360047",
"?cat=569024734",
"?cat=29157499",
"?cat=31196879",
"?cat=5512020",
"?cat=34725375",
"?cat=36054263",
"?cat=33355335",
"?cat=87590838",
"?cat=40828510",
"?cat=357720",
"?cat=21134265",
"?cat=573195272",
"?cat=574561691",
"?cat=575701727",
"?cat=576085250",
"?cat=577050481",
"?cat=577570230",
"?cat=577913772",
"?cat=578417732",
"?cat=578840672",
"?cat=75668967",
"?cat=51691835",
"?cat=33249381",
"?cat=27200775",
"?cat=20602630",
"?cat=21388087",
"?cat=22963148",
"?cat=27200899",
"?cat=24835832",
"?cat=2185147",
"?cat=13623805",
"?cat=25823297",
"?cat=50476587",
"?cat=43740857",
"?cat=87506775",
"?cat=584526785",
"?cat=584847360",
"?cat=24704219",
"?cat=31292666",
"?cat=33295362",
"?cat=34725379",
"?cat=36350025",
"?cat=41945934",
"?cat=85836209",
"?cat=51592293",
"?cat=27143348",
"?cat=2250628",
"?cat=13370345",
"?cat=28156413",
"?cat=27165894",
"?cat=29778104",
"?cat=23669776",
"?cat=40867025",
"?cat=19448797",
"?cat=88651429",
"?cat=15083065",
"?cat=1540262",
"?cat=586242134",
"?cat=592435863",
"?cat=69991537",
"?cat=142421083",
"?cat=200228566",
"?cat=109800200",
]

with open("twig_full.html", "w", encoding="utf-8") as out:
    with open("links.txt", "w", encoding="utf-8") as link_out:
        for chapter in chapters:
            url = f"{base}/{chapter}"
            r = requests.get(url, allow_redirects=True)
            # r = requests.get(url)
            # get the real URL that should look something like https://twigserial.wordpress.com/category/story/arc-1-taking-root/1-01/ and check the text before the last slash
            real_url = r.url
            if len(real_url.split("/")) < 8:
                continue
            data = real_url.split("/")[-1]
            if len(data) == 0:
                data = real_url.split("/")[-2]
            print(real_url)
            link_out.write(real_url + "\n")
            out.write(r.text)
            out.write("\n\n" + "="*50 + "\n\n")
